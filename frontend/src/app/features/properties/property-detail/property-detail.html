<!-- src/app/features/properties/property-detail/property-detail.html -->
<div class="container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-3">Loading property details...</p>
    </div>
  </div>

  <!-- Property Detail Content -->
  <div *ngIf="!loading && property" class="property-detail">
    <!-- Back Button and Actions -->
    <div class="back-navigation">
      <div class="d-flex justify-content-between align-items-center">
        <button class="btn btn-outline-secondary" (click)="goBack()">
          <i class="fas fa-arrow-left"></i> Back to Properties
        </button>
        <button 
          class="btn btn-comparison"
          [class.selected]="isInComparison"
          [disabled]="!canAddToComparison && !isInComparison"
          (click)="toggleComparison()"
          [title]="getComparisonButtonText()"
        >
          <i [class]="getComparisonIcon()"></i>
          {{ getComparisonButtonText() }}
        </button>
      </div>
    </div>

    <!-- Property Header -->
    <div class="property-header">
      <div class="row">
        <div class="col-lg-8">
          <h1 class="property-title">{{ property.title }}</h1>
          <div class="property-location">
            <i class="fas fa-map-marker-alt"></i>
            <span>{{ property.location }}</span>
          </div>
          <div class="property-price">${{ property.price | number }}</div>
        </div>
        <div class="col-lg-4 text-lg-end">
          <div class="property-type-badge">{{ property.type }}</div>
        </div>
      </div>
    </div>

    <!-- Tabbed Media Viewer -->
    <div class="media-viewer-section">
      <!-- Media Tabs -->
      <div class="media-tabs">
        <button 
          class="media-tab"
          [class.active]="activeMediaTab === 'photos'"
          (click)="setActiveTab('photos')"
        >
          <i class="fas fa-images"></i>
          Photos <span class="count">({{ getImageCount() }})</span>
        </button>
        <button 
          class="media-tab"
          [class.active]="activeMediaTab === 'video'"
          (click)="setActiveTab('video')"
          *ngIf="hasVideo()"
        >
          <i class="fas fa-video"></i>
          Video Walkthrough
        </button>
      </div>

      <!-- Tab Content -->
      <div class="media-content">
        <!-- Photos Tab -->
        <div class="photos-tab" *ngIf="activeMediaTab === 'photos'">
          <!-- Main Image Display -->
          <div class="main-image-container" (click)="openLightbox(currentImageIndex)">
            <img
              [src]="getCurrentImage()"
              [alt]="property.title"
              class="property-main-image"
            />
            <div class="image-overlay">
              <i class="fas fa-expand"></i>
              <span>Click to enlarge</span>
            </div>
          </div>
          
          <!-- Thumbnail Gallery -->
          <div class="thumbnail-gallery" *ngIf="getImages().length > 1">
            <button 
              class="gallery-nav prev"
              (click)="previousImage()"
              [disabled]="currentImageIndex === 0"
            >
              <i class="fas fa-chevron-left"></i>
            </button>
            
            <div class="thumbnails-container">
              <div class="thumbnails-track">
                <div 
                  *ngFor="let image of getImages(); let i = index"
                  class="thumbnail"
                  [class.active]="currentImageIndex === i"
                  (click)="selectImage(i)"
                >
                  <img [src]="getImageUrl(image)" [alt]="'Image ' + (i + 1)" />
                </div>
              </div>
            </div>
            
            <button 
              class="gallery-nav next"
              (click)="nextImage()"
              [disabled]="currentImageIndex === getImages().length - 1"
            >
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>

        <!-- Video Tab -->
        <div class="video-tab" *ngIf="activeMediaTab === 'video'">
          <div class="video-container" *ngIf="hasVideo()">
            <video 
              #videoPlayer
              [src]="getVideoUrl()"
              controls
              preload="metadata"
              class="property-video"
              poster=""
            >
              Your browser does not support the video tag.
            </video>
            
            <!-- Custom Controls Overlay -->
            <div class="video-controls">
              <button class="play-button" (click)="toggleVideoPlay()" *ngIf="!isVideoPlaying">
                <i class="fas fa-play-circle"></i>
              </button>
            </div>
          </div>
          
          <!-- No Video Message -->
          <div class="no-video-message" *ngIf="!hasVideo()">
            <i class="fas fa-video-slash"></i>
            <h4>No Video Available</h4>
            <p>This property doesn't have a video walkthrough yet.</p>
          </div>
        </div>
      </div>

      <!-- Lightbox Modal -->
      <div class="lightbox-modal" *ngIf="isLightboxOpen" (click)="closeLightbox()">
        <div class="lightbox-content" (click)="$event.stopPropagation()">
          <button class="lightbox-close" (click)="closeLightbox()">
            <i class="fas fa-times"></i>
          </button>
          
          <button 
            class="lightbox-nav prev"
            (click)="lightboxPrevious(); $event.stopPropagation()"
            *ngIf="lightboxIndex > 0"
          >
            <i class="fas fa-chevron-left"></i>
          </button>
          
          <img 
            [src]="getLightboxImage()"
            [alt]="'Image ' + (lightboxIndex + 1)"
            class="lightbox-image"
          />
          
          <button 
            class="lightbox-nav next"
            (click)="lightboxNext(); $event.stopPropagation()"
            *ngIf="lightboxIndex < getImages().length - 1"
          >
            <i class="fas fa-chevron-right"></i>
          </button>
          
          <div class="lightbox-counter">
            {{ lightboxIndex + 1 }} / {{ getImages().length }}
          </div>
        </div>
      </div>
    </div>

    <!-- Property Info Grid -->
    <div class="row mt-4">
      <!-- Main Details -->
      <div class="col-lg-8">
        <div class="detail-section">
          <h3>Property Details</h3>
          <div class="property-specs">
            <div class="spec-item">
              <i class="fas fa-bed"></i>
              <span class="spec-value">{{ property.bedrooms }}</span>
              <span class="spec-label">Bedrooms</span>
            </div>
            <div class="spec-item">
              <i class="fas fa-bath"></i>
              <span class="spec-value">{{ property.bathrooms }}</span>
              <span class="spec-label">Bathrooms</span>
            </div>
            <div class="spec-item">
              <i class="fas fa-ruler-combined"></i>
              <span class="spec-value">{{ property.area }}</span>
              <span class="spec-label">Sq Ft</span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h3>Description</h3>
          <p class="property-description">{{ property.description }}</p>
          <p class="extended-description">
            This beautiful {{ property.type.toLowerCase() }} in {{
            property.location }} offers modern living with {{ property.bedrooms
            }} spacious bedrooms and {{ property.bathrooms }} well-appointed
            bathrooms. With {{ property.area }} square feet of living space,
            this property provides comfort and convenience in one of the most
            sought-after areas in the Kitchener-Waterloo region.
          </p>
        </div>

        <div class="detail-section">
          <h3>Features & Amenities</h3>
          <div class="features-grid">
            <div class="feature-item">
              <i class="fas fa-check-circle"></i>
              <span>Modern Kitchen</span>
            </div>
            <div class="feature-item">
              <i class="fas fa-check-circle"></i>
              <span>Hardwood Floors</span>
            </div>
            <div class="feature-item">
              <i class="fas fa-check-circle"></i>
              <span>Central Air</span>
            </div>
            <div class="feature-item">
              <i class="fas fa-check-circle"></i>
              <span>Parking Available</span>
            </div>
            <div class="feature-item">
              <i class="fas fa-check-circle"></i>
              <span>Close to Transit</span>
            </div>
            <div class="feature-item">
              <i class="fas fa-check-circle"></i>
              <span>Pet Friendly</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="col-lg-4">
        <div class="contact-card">
          <h4>Interested in this property?</h4>
          <p>
            Contact our real estate professionals for more information or to
            schedule a viewing.
          </p>

          <div class="contact-buttons">
            <button class="btn btn-primary btn-block mb-2">
              <i class="fas fa-phone"></i> Call Now
            </button>
            <button class="btn btn-outline-primary btn-block mb-2">
              <i class="fas fa-envelope"></i> Send Message
            </button>
            <button class="btn btn-outline-secondary btn-block">
              <i class="fas fa-calendar"></i> Schedule Tour
            </button>
          </div>

          <div class="agent-info mt-4">
            <h5>Your Agent</h5>
            <div class="agent-profile">
              <img
                src="https://via.placeholder.com/60x60/007bff/ffffff?text=AG"
                alt="Agent"
                class="agent-avatar"
              />
              <div class="agent-details">
                <strong>Sarah Johnson</strong>
                <p>Real Estate Professional</p>
                <p><i class="fas fa-phone"></i> (519) 555-0123</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
