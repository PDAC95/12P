<!-- src/app/features/properties/property-card/property-card.html -->
<div class="card h-100 shadow-sm property-card" [class.comparison-selected]="isSelectedForComparison">
  <div class="card-img-container" [class.selected-for-comparison]="isSelectedForComparison">
    <img [src]="property.image" class="card-img-top" [alt]="property.title" />

    <!-- Property type badge on the left -->
    <div class="property-type-badge">{{ property.type }}</div>

    <!-- Media indicators -->
    <div class="media-indicators">
      <span class="media-badge photo-count" *ngIf="getImageCount() > 0">
        ðŸ“· {{ getImageCount() }}
      </span>
      <span class="media-badge video-indicator" *ngIf="hasVideo()">
        ðŸŽ¥
      </span>
    </div>

    <!-- Comparison indicator -->
    <div class="comparison-indicator" *ngIf="isSelectedForComparison">
      <i class="fas fa-check-circle"></i>
      <span>Selected</span>
    </div>

    <!-- Action buttons container -->
    <div class="card-actions">
      <!-- Compare button -->
      <button 
        class="compare-button"
        [class.selected]="isSelectedForComparison"
        [class.disabled]="!canAddToComparison && !isSelectedForComparison"
        [disabled]="!canAddToComparison && !isSelectedForComparison"
        [title]="getCompareTooltip()"
        (click)="onCompareClick($event)"
      >
        <i [class]="getCompareIcon()"></i>
        <span class="compare-counter" *ngIf="comparisonCount > 0">{{ comparisonCount }}/3</span>
      </button>
      
      <!-- Favorite button -->
      <app-favorite-button
        [propertyId]="property._id"
        size="medium"
        (favoriteChanged)="onFavoriteChanged($event)"
      ></app-favorite-button>
    </div>
  </div>

  <div class="card-body">
    <h5 class="card-title">{{ property.title }}</h5>
    <p class="card-text location">
      <i class="fas fa-map-marker-alt"></i> {{ property.location }}
    </p>
    <p class="card-text description">{{ property.description }}</p>

    <div class="property-details">
      <span class="detail-item">
        <i class="fas fa-bed"></i> {{ property.bedrooms }} bed
      </span>
      <span class="detail-item">
        <i class="fas fa-bath"></i> {{ property.bathrooms }} bath
      </span>
      <span class="detail-item">
        <i class="fas fa-ruler-combined"></i> {{ property.area }} sqft
      </span>
    </div>

    <!-- Agent Information Section -->
    <div class="agent-info" *ngIf="!isLoadingAgent">
      <div class="agent-details" *ngIf="agentInfo">
        <i [class]="getAgentRoleIcon()"></i>
        <span class="agent-name">{{ getAgentDisplayName() }}</span>
        <span class="agent-role"
          >{{ userService.getRoleDisplayName(agentInfo.role) }}</span
        >
      </div>
      <div class="agent-details" *ngIf="!agentInfo">
        <i class="fas fa-user"></i>
        <span class="agent-name">Agent info unavailable</span>
      </div>
    </div>
    <div class="agent-info loading" *ngIf="isLoadingAgent">
      <i class="fas fa-spinner fa-spin"></i>
      <span>Loading agent info...</span>
    </div>

    <div class="price-section">
      <strong class="price">${{ property.price | number }}</strong>
      <div class="action-buttons">
        <button
          class="btn btn-primary btn-sm"
          [routerLink]="['/properties/detail', property.id]"
          (click)="onViewDetailsClick()"
        >
          View Details
        </button>
        <button
          class="btn btn-outline-secondary btn-sm"
          [routerLink]="['/user', property.owner]"
          (click)="onViewAgentClick()"
        >
          <i class="fas fa-user"></i> View Agent
        </button>
      </div>
    </div>
  </div>
</div>
