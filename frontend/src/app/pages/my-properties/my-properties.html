<!-- My Properties Page with Sidebar -->
<div class="dashboard-container" [class.sidebar-collapsed]="isSidebarCollapsed">
  
  <!-- Sidebar -->
  <aside class="dashboard-sidebar" [class.mobile-open]="isMobileSidebarOpen">
    <!-- Brand/Logo -->
    <div class="sidebar-brand">
      <a routerLink="/" class="brand-link">
        <img *ngIf="!isSidebarCollapsed" 
             src="assets/images/logos/logo-navbar.png" 
             alt="12P Logo" 
             class="sidebar-logo-img">
        <img *ngIf="isSidebarCollapsed" 
             src="https://res.cloudinary.com/dsgnzaylf/image/upload/v1757010532/pin_rcsy8w.png" 
             alt="12P Pin Logo" 
             class="sidebar-logo-collapsed">
      </a>
    </div>

    <!-- Agent Profile Section -->
    <div class="sidebar-profile">
      <div class="profile-avatar">
        <img *ngIf="currentUser?.profileImage || currentUser?.avatar" 
             [src]="currentUser?.profileImage || currentUser?.avatar" 
             [alt]="agentName"
             class="avatar-img">
        <div *ngIf="!currentUser?.profileImage && !currentUser?.avatar" class="avatar-initials">
          {{ getInitials(agentName) }}
        </div>
      </div>
      <div class="profile-info" *ngIf="!isSidebarCollapsed">
        <h4 class="profile-name">{{ agentName }}</h4>
        <p class="profile-role">Real Estate Agent</p>
      </div>
    </div>

    <!-- Navigation Menu -->
    <nav class="sidebar-nav">
      <ul class="nav-list">
        <li class="nav-item" *ngFor="let item of navItems; trackBy: trackByNavItem">
          <a [routerLink]="item.route" 
             class="nav-link"
             routerLinkActive="active"
             [routerLinkActiveOptions]="{exact: item.route === '/agent/properties'}">
            <i [class]="item.icon"></i>
            <span class="nav-text" *ngIf="!isSidebarCollapsed">{{ item.name }}</span>
          </a>
        </li>
        
        <!-- Separator -->
        <li class="nav-separator"></li>
        
        <!-- Logout -->
        <li class="nav-item">
          <a class="nav-link logout-link" (click)="onLogout()">
            <i class="fas fa-sign-out-alt"></i>
            <span class="nav-text" *ngIf="!isSidebarCollapsed">Logout</span>
          </a>
        </li>
      </ul>
    </nav>

    <!-- Sidebar Toggle -->
    <div class="sidebar-toggle" (click)="toggleSidebar()">
      <i class="fas fa-chevron-left"></i>
    </div>
  </aside>

  <!-- Mobile Sidebar Backdrop -->
  <div class="mobile-backdrop" 
       *ngIf="isMobileSidebarOpen" 
       (click)="closeMobileSidebar()"></div>

  <!-- Main Content -->
  <main class="dashboard-main">
    <!-- Header -->
    <header class="dashboard-header">
      <div class="header-left">
        <button class="mobile-menu-btn" (click)="toggleMobileSidebar()">
          <i class="fas fa-bars"></i>
        </button>
        <h1 class="page-title">
          <i class="fas fa-building"></i>
          My Properties Management
        </h1>
      </div>
      <div class="header-right">
        <button class="btn btn-primary" routerLink="/add-property">
          <i class="fas fa-plus-circle"></i>
          <span class="btn-text">Add Property</span>
        </button>
      </div>
    </header>

    <!-- Dashboard Content -->
    <div class="dashboard-content">
      <!-- Stats Row -->
      <div class="stats-row">
        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">
            <i class="fas fa-building"></i>
          </div>
          <div class="stat-content">
            <h3 class="stat-value">{{ stats.totalProperties }}</h3>
            <p class="stat-label">Total Properties</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #00c851, #00b359);">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="stat-content">
            <h3 class="stat-value">{{ stats.activeProperties }}</h3>
            <p class="stat-label">Active Listings</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #ff6b6b, #ff5252);">
            <i class="fas fa-handshake"></i>
          </div>
          <div class="stat-content">
            <h3 class="stat-value">{{ stats.soldProperties }}</h3>
            <p class="stat-label">Sold Properties</p>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #ffd93d, #ffb300);">
            <i class="fas fa-dollar-sign"></i>
          </div>
          <div class="stat-content">
            <h3 class="stat-value">{{ stats.totalValue | currency:'USD':'symbol':'1.0-0' }}</h3>
            <p class="stat-label">Total Portfolio Value</p>
          </div>
        </div>
      </div>

      <!-- Properties Section -->
      <div class="properties-section">
        <div class="section-header">
          <h2 class="section-title">Property Listings</h2>
        </div>

        <!-- Filters and Search -->
        <div class="filters-row">
          <div class="filter-group">
            <div class="search-box">
              <i class="fas fa-search"></i>
              <input type="text" 
                     placeholder="Search by title or location..." 
                     (input)="onSearch($event)"
                     class="search-input">
            </div>
          </div>
          
          <div class="filter-group">
            <select [(ngModel)]="filterStatus" (change)="onStatusFilterChange()" class="filter-select">
              <option value="all">All Status</option>
              <option value="available">Available</option>
              <option value="active">Active</option>
              <option value="sold">Sold</option>
              <option value="rented">Rented</option>
              <option value="pending">Pending</option>
            </select>
            
            <select [(ngModel)]="filterType" (change)="onTypeFilterChange()" class="filter-select">
              <option *ngFor="let type of propertyTypes" [value]="type.value">
                {{ type.label }}
              </option>
            </select>
            
            <select [(ngModel)]="filterPriceRange" (change)="onPriceFilterChange()" class="filter-select">
              <option *ngFor="let range of priceRanges" [value]="range.value">
                {{ range.label }}
              </option>
            </select>
            
            <select [(ngModel)]="sortBy" (change)="onSortChange()" class="filter-select">
              <option value="recent">Most Recent</option>
              <option value="price-high">Price: High to Low</option>
              <option value="price-low">Price: Low to High</option>
              <option value="views">Most Viewed</option>
              <option value="inquiries">Most Inquiries</option>
            </select>
          </div>
        </div>

        <!-- Loading State -->
        <div *ngIf="isLoading" class="loading-state">
          <div class="spinner"></div>
          <p>Loading properties...</p>
        </div>

        <!-- Error State -->
        <div *ngIf="!isLoading && errorMessage" class="error-state">
          <i class="fas fa-exclamation-triangle"></i>
          <p>{{ errorMessage }}</p>
          <button class="btn btn-primary" (click)="loadProperties()">Try Again</button>
        </div>

        <!-- Empty State -->
        <div *ngIf="!isLoading && !errorMessage && properties.length === 0" class="empty-state-container">
          <div class="empty-state-content">
            <i class="fas fa-building empty-state-icon"></i>
            <h3 class="empty-state-title">No Properties Yet</h3>
            <p class="empty-state-subtitle">Start building your real estate portfolio</p>
            <button class="btn btn-add-first" routerLink="/add-property">
              <i class="fas fa-plus-circle"></i> Add Your First Property
            </button>
          </div>
        </div>

        <!-- Properties Table -->
        <div class="table-responsive" *ngIf="!isLoading && !errorMessage && properties.length > 0">
          <table class="properties-table">
            <thead>
              <tr>
                <th>Property</th>
                <th>Location</th>
                <th>Price</th>
                <th>Status</th>
                <th>Views</th>
                <th>Inquiries</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let property of getPaginatedProperties(); trackBy: trackByProperty">
                <td class="property-cell">
                  <div class="property-info">
                    <img [src]="property.image" 
                         [alt]="property.title"
                         class="property-thumb">
                    <div>
                      <h5 class="property-title">{{ property.title }}</h5>
                      <p class="property-meta">
                        <i class="fas fa-bed"></i> {{ property.bedrooms }} |
                        <i class="fas fa-bath"></i> {{ property.bathrooms }} |
                        <i class="fas fa-ruler-combined"></i> {{ property.area }} sqft
                      </p>
                    </div>
                  </div>
                </td>
                <td>{{ property.location }}</td>
                <td class="price-cell">{{ property.price | currency:'USD':'symbol':'1.0-0' }}</td>
                <td>
                  <span class="status-badge" 
                        [class.status-active]="property.status === 'active' || property.status === 'available'"
                        [class.status-sold]="property.status === 'sold'"
                        [class.status-rented]="property.status === 'rented'"
                        [class.status-pending]="property.status === 'pending'">
                    {{ property.status }}
                  </span>
                </td>
                <td class="metric-cell">
                  <i class="fas fa-eye"></i> {{ property.views }}
                </td>
                <td class="metric-cell">
                  <i class="fas fa-envelope"></i> {{ property.inquiries }}
                </td>
                <td>
                  <div class="action-buttons">
                    <button class="btn-action" 
                            title="View property"
                            (click)="viewProperty(property)">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn-action" 
                            title="Edit property"
                            (click)="editProperty(property)">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-action btn-danger" 
                            title="Delete property"
                            (click)="confirmDelete(property)">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
              
              <!-- No results after filtering -->
              <tr *ngIf="filteredProperties.length === 0 && properties.length > 0">
                <td colspan="7" class="no-results">
                  <p>No properties match your filters</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="pagination-wrapper" *ngIf="totalPages > 1">
          <div class="pagination">
            <button class="page-btn" 
                    [disabled]="currentPage === 1"
                    (click)="goToPage(currentPage - 1)">
              <i class="fas fa-chevron-left"></i>
            </button>
            
            <button *ngFor="let page of [].constructor(totalPages); let i = index"
                    class="page-btn"
                    [class.active]="currentPage === i + 1"
                    (click)="goToPage(i + 1)">
              {{ i + 1 }}
            </button>
            
            <button class="page-btn" 
                    [disabled]="currentPage === totalPages"
                    (click)="goToPage(currentPage + 1)">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
          
          <div class="page-info">
            Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to 
            {{ Math.min(currentPage * itemsPerPage, filteredProperties.length) }} 
            of {{ filteredProperties.length }} properties
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-backdrop" *ngIf="showDeleteConfirm" (click)="cancelDelete()"></div>
<div class="modal" *ngIf="showDeleteConfirm">
  <div class="modal-content">
    <h3>Confirm Delete</h3>
    <p>Are you sure you want to delete this property? This action cannot be undone.</p>
    <div class="modal-actions">
      <button class="btn btn-secondary" (click)="cancelDelete()">Cancel</button>
      <button class="btn btn-danger" (click)="deleteProperty()">Delete Property</button>
    </div>
  </div>
</div>