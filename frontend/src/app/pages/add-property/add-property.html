<!-- Add Property Page with Agent Layout -->
<app-agent-layout 
  pageTitle="Add New Property" 
  pageIcon="fas fa-plus-circle"
  [showHeaderActions]="false">
  
  <div class="add-property-page">
    <!-- Page Header -->
    <section class="add-property-header">
      <div class="container">
        <div class="header-content">
          <h1 class="page-title">
            <span class="title-line">Add Your</span>
            <span class="title-line"
              ><span class="highlight">Property</span></span
            >
          </h1>
          <p class="page-description">
            List your property with us and reach thousands of potential buyers and
            renters.
          </p>
        </div>
      </div>
    </section>

  <!-- Success Message -->
  <div class="success-overlay" *ngIf="isSubmitted">
    <div class="success-content">
      <div class="success-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <h3>Property Listed Successfully!</h3>
      <p>
        Your property has been submitted for review. We'll contact you within 24
        hours.
      </p>
    </div>
  </div>

  <!-- Main Content -->
  <section class="add-property-content" *ngIf="!isSubmitted">
    <div class="container">
      <!-- Progress Steps -->
      <div class="progress-steps">
        <div
          class="step"
          [class.active]="currentStep >= 1"
          [class.completed]="currentStep > 1"
        >
          <div class="step-number">1</div>
          <div class="step-label">Property Details</div>
        </div>
        <div class="step-line" [class.completed]="currentStep > 1"></div>
        <div
          class="step"
          [class.active]="currentStep >= 2"
          [class.completed]="currentStep > 2"
        >
          <div class="step-number">2</div>
          <div class="step-label">Features & Images</div>
        </div>
      </div>

      <!-- Form Container -->
      <div class="form-container">
        <div class="form-header">
          <h3>{{ getStepTitle() }}</h3>
          <p>Step {{ currentStep }} of {{ totalSteps }}</p>
        </div>

        <form (ngSubmit)="onSubmit()" #propertyFormRef="ngForm">
          <!-- Step 1: Property Details -->
          <div class="form-step" *ngIf="currentStep === 1">
            <div class="form-row">
              <div class="form-group full-width">
                <label for="title">Property Title *</label>
                <input
                  type="text"
                  id="title"
                  name="title"
                  [(ngModel)]="propertyForm.title"
                  required
                  class="form-control"
                  placeholder="e.g., Modern 3-Bedroom Condo in Downtown"
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="type">Property Type *</label>
                <select
                  id="type"
                  name="type"
                  [(ngModel)]="propertyForm.type"
                  required
                  class="form-control"
                >
                  <option value="">Select property type</option>
                  <option *ngFor="let type of propertyTypes" [value]="type">
                    {{ type }}
                  </option>
                </select>
              </div>
              <div class="form-group">
                <label for="price">Price (CAD) *</label>
                <input
                  type="number"
                  id="price"
                  name="price"
                  [(ngModel)]="propertyForm.price"
                  required
                  class="form-control"
                  placeholder="500000"
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="bedrooms">Bedrooms</label>
                <input
                  type="number"
                  id="bedrooms"
                  name="bedrooms"
                  [(ngModel)]="propertyForm.bedrooms"
                  class="form-control"
                  min="0"
                  max="10"
                />
              </div>
              <div class="form-group">
                <label for="bathrooms">Bathrooms</label>
                <input
                  type="number"
                  id="bathrooms"
                  name="bathrooms"
                  [(ngModel)]="propertyForm.bathrooms"
                  class="form-control"
                  min="0"
                  max="10"
                  step="0.5"
                />
              </div>
              <div class="form-group">
                <label for="area">Area (sq ft)</label>
                <input
                  type="number"
                  id="area"
                  name="area"
                  [(ngModel)]="propertyForm.area"
                  class="form-control"
                  placeholder="1200"
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="address">Street Address *</label>
                <input
                  type="text"
                  id="address"
                  name="address"
                  [(ngModel)]="propertyForm.location.address"
                  required
                  class="form-control"
                  placeholder="e.g., 123 Main Street"
                />
              </div>
              <div class="form-group">
                <label for="city">City *</label>
                <input
                  type="text"
                  id="city"
                  name="city"
                  [(ngModel)]="propertyForm.location.city"
                  required
                  class="form-control"
                  placeholder="e.g., Toronto"
                />
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="province">Province *</label>
                <select
                  id="province"
                  name="province"
                  [(ngModel)]="propertyForm.location.province"
                  required
                  class="form-control"
                >
                  <option value="">Select province</option>
                  <option value="Ontario">Ontario</option>
                  <option value="Quebec">Quebec</option>
                  <option value="British Columbia">British Columbia</option>
                  <option value="Alberta">Alberta</option>
                  <option value="Manitoba">Manitoba</option>
                  <option value="Saskatchewan">Saskatchewan</option>
                  <option value="Nova Scotia">Nova Scotia</option>
                  <option value="New Brunswick">New Brunswick</option>
                  <option value="Newfoundland and Labrador">Newfoundland and Labrador</option>
                  <option value="Prince Edward Island">Prince Edward Island</option>
                </select>
              </div>
              <div class="form-group">
                <label for="postalCode">Postal Code</label>
                <input
                  type="text"
                  id="postalCode"
                  name="postalCode"
                  [(ngModel)]="propertyForm.location.postalCode"
                  class="form-control"
                  placeholder="e.g., M5V 3A8"
                />
              </div>
              <div class="form-group">
                <label for="listingType">Listing Type *</label>
                <select
                  id="listingType"
                  name="listingType"
                  [(ngModel)]="propertyForm.listingType"
                  required
                  class="form-control"
                >
                  <option value="sale">For Sale</option>
                  <option value="rent">For Rent</option>
                  <option value="coliving">Co-living</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group full-width">
                <label for="description">Description *</label>
                <textarea
                  id="description"
                  name="description"
                  [(ngModel)]="propertyForm.description"
                  required
                  class="form-control"
                  rows="6"
                  placeholder="Describe your property, its unique features, neighborhood, and what makes it special..."
                ></textarea>
              </div>
            </div>
          </div>

          <!-- Step 2: Features & Images -->
          <div class="form-step" *ngIf="currentStep === 2">
            <div class="form-group">
              <label>Property Features</label>
              <div class="features-grid">
                <div
                  *ngFor="let feature of availableFeatures"
                  class="feature-item"
                  [class.selected]="isFeatureSelected(feature)"
                  (click)="toggleFeature(feature)"
                >
                  <i
                    class="fas fa-check"
                    *ngIf="isFeatureSelected(feature)"
                  ></i>
                  <span>{{ feature }}</span>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label>Property Images</label>
              
              <!-- Upload Area -->
              <div 
                class="image-upload-area"
                [class.dragging]="isDragging"
                (dragover)="onDragOver($event)"
                (dragleave)="onDragLeave($event)"
                (drop)="onDrop($event)"
                *ngIf="selectedImages.length < maxImages"
              >
                <div class="upload-placeholder">
                  <i class="fas fa-cloud-upload-alt"></i>
                  <h4>Upload Property Images</h4>
                  <p>Drag and drop images here or click to browse</p>
                  <input
                    type="file"
                    id="fileInput"
                    accept="image/jpeg,image/jpg,image/png,image/webp"
                    multiple
                    (change)="onFileSelect($event)"
                    style="display: none"
                  />
                  <button 
                    type="button" 
                    class="upload-btn"
                    onclick="document.getElementById('fileInput')?.click()"
                  >
                    Choose Images
                  </button>
                </div>
              </div>

              <!-- Error Message -->
              <div class="upload-error" *ngIf="uploadError">
                <i class="fas fa-exclamation-circle"></i>
                {{ uploadError }}
              </div>

              <!-- Image Previews -->
              <div class="image-previews" *ngIf="selectedImages.length > 0">
                <div 
                  class="preview-item" 
                  *ngFor="let image of selectedImages; let i = index"
                  [class.primary]="i === 0"
                >
                  <img [src]="image.preview" [alt]="'Property image ' + (i + 1)" />
                  <div class="preview-overlay">
                    <button 
                      type="button" 
                      class="btn-primary-image"
                      (click)="setPrimaryImage(i)"
                      *ngIf="i !== 0"
                      title="Set as primary image"
                    >
                      <i class="fas fa-star"></i>
                    </button>
                    <button 
                      type="button" 
                      class="btn-remove"
                      (click)="removeImage(i)"
                      title="Remove image"
                    >
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                  <span class="primary-badge" *ngIf="i === 0">Primary</span>
                </div>
              </div>

              <p class="upload-hint">
                You can upload up to {{ maxImages }} images ({{ selectedImages.length }}/{{ maxImages }} selected). 
                Supported formats: JPG, PNG, WEBP. Max size: 5MB per image.
              </p>
            </div>

            <!-- Video Upload Section -->
            <div class="form-group">
              <label>Property Walkthrough Video <span class="optional">(Optional)</span></label>
              
              <!-- Video Upload Area -->
              <div 
                class="video-upload-area"
                [class.dragging]="isVideoDragging"
                (dragover)="onVideoDragOver($event)"
                (dragleave)="onVideoDragLeave($event)"
                (drop)="onVideoDrop($event)"
                *ngIf="!selectedVideo"
              >
                <div class="upload-placeholder">
                  <i class="fas fa-video"></i>
                  <h4>Upload Walkthrough Video</h4>
                  <p>Drag and drop a video here or click to browse</p>
                  <input
                    type="file"
                    id="videoInput"
                    accept="video/mp4,video/quicktime,video/x-msvideo"
                    (change)="onVideoSelect($event)"
                    style="display: none"
                  />
                  <button 
                    type="button" 
                    class="upload-btn"
                    onclick="document.getElementById('videoInput')?.click()"
                  >
                    Choose Video
                  </button>
                </div>
              </div>

              <!-- Video Error Message -->
              <div class="upload-error" *ngIf="videoUploadError">
                <i class="fas fa-exclamation-circle"></i>
                {{ videoUploadError }}
              </div>

              <!-- Video Preview -->
              <div class="video-preview" *ngIf="selectedVideo">
                <div class="preview-container">
                  <video 
                    [src]="selectedVideo.preview" 
                    controls
                    preload="metadata"
                    class="video-player"
                  ></video>
                  <div class="video-info">
                    <div class="video-details">
                      <i class="fas fa-film"></i>
                      <span class="video-name">{{ selectedVideo.file.name }}</span>
                      <span class="video-size">{{ formatFileSize(selectedVideo.file.size) }}</span>
                    </div>
                    <div class="video-actions">
                      <button 
                        type="button" 
                        class="btn-replace"
                        onclick="document.getElementById('videoInput')?.click()"
                        title="Replace video"
                      >
                        <i class="fas fa-sync-alt"></i>
                        Replace
                      </button>
                      <button 
                        type="button" 
                        class="btn-remove"
                        (click)="removeVideo()"
                        title="Remove video"
                      >
                        <i class="fas fa-times"></i>
                        Remove
                      </button>
                    </div>
                  </div>
                  
                  <!-- Upload Progress -->
                  <div class="upload-progress" *ngIf="videoUploadProgress > 0 && videoUploadProgress < 100">
                    <div class="progress-bar">
                      <div class="progress-fill" [style.width.%]="videoUploadProgress"></div>
                    </div>
                    <span class="progress-text">Uploading... {{ videoUploadProgress }}%</span>
                  </div>
                </div>
              </div>

              <p class="upload-hint">
                You can upload one walkthrough video. 
                Supported formats: MP4, MOV, AVI. Max size: 50MB. Max duration: 5 minutes.
              </p>
            </div>
          </div>


          <!-- Navigation Buttons -->
          <div class="form-navigation">
            <button
              type="button"
              class="nav-btn prev-btn"
              (click)="prevStep()"
              *ngIf="currentStep > 1"
            >
              <i class="fas fa-arrow-left"></i>
              Previous
            </button>

            <button
              type="button"
              class="nav-btn next-btn"
              (click)="nextStep()"
              *ngIf="currentStep < totalSteps"
            >
              Next
              <i class="fas fa-arrow-right"></i>
            </button>

            <button
              type="submit"
              class="nav-btn submit-btn"
              *ngIf="currentStep === totalSteps"
              [disabled]="!propertyFormRef.form.valid || isSubmitting"
            >
              <span *ngIf="!isSubmitting">
                <i class="fas fa-check"></i>
                Submit Property
              </span>
              <span *ngIf="isSubmitting">
                <i class="fas fa-spinner fa-spin"></i>
                Submitting...
              </span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </section>
  </div>
</app-agent-layout>
